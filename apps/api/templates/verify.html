<!doctype html>
<html>
<head>
    <title>Verifikasi Ijazah</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
        .status { padding: 1rem; border-radius: 5px; text-align: center; font-weight: bold; font-size: 1.5rem; margin-bottom: 1rem;}
        .valid { background-color: #d4edda; color: #155724; }
        .invalid { background-color: #f8d7da; color: #721c24; }
        .revoked { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        pre { background: #f4f4f4; padding: 1rem; border: 1px solid #ddd; white-space: pre-wrap; }
        button { padding: 10px 20px; font-size: 1rem; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        button:hover { background: #0056b3; }
        .metadata { font-size: 0.9rem; color: #555; margin-bottom: 10px; }
    </style>
</head>
<body>

    <h2>Hasil Verifikasi Ijazah</h2>

    {% if valid %}
        <div class="status valid">STATUS: VALID (TERVERIFIKASI)</div>
    {% else %}
        <div class="status invalid">STATUS: TIDAK VALID</div>
        {% if error %}<p style="text-align:center; color:red;">{{error}}</p>{% endif %}
    {% endif %}

    <div class="metadata">
        <p>Issuer Terpercaya: {{ "YA" if trusted_issuer else "TIDAK (Unknown Issuer)" }}</p>
        {% if revoked %}
            <div class="status revoked">PERINGATAN: Sertifikat ini telah DICABUT (REVOKED)</div>
        {% endif %}
    </div>

    <h3>Isi Dokumen:</h3>
    <textarea id="original-text" style="display:none;">{{text}}</textarea>
    
    <pre id="display-text">{{text}}</pre>

    {% if valid %}
    <div style="text-align: center; margin-top: 2rem;">
        <p>Unduh salinan ijazah yang telah diverifikasi (URL Verifikasi akan ditambahkan otomatis):</p>
        <button onclick="downloadWithUrl()">Download Ijazah Resmi</button>
    </div>
    {% endif %}

    <script>
        function downloadWithUrl() {
            // 1. Ambil teks asli
            const originalText = document.getElementById('original-text').value;
            
            // 2. Ambil URL Verifikasi
            const verifyUrl = "{{ verify_url | safe }}";

            // 3. Gabungkan sesuai spesifikasi
            const finalText = originalText + "\n\n" +
                              "Dokumen ini telah diverifikasi secara digital.\n" +
                              "Link Verifikasi: " + verifyUrl + "\n";

            // 4. Buat file Blob
            const blob = new Blob([finalText], { type: 'text/plain' });
            
            // 5. Trigger download
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = "Ijazah_Terverifikasi.txt";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>

</body>
</html>